(function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{const i=e();for(const e in i)("object"==typeof exports?exports:t)[e]=i[e]}})(self,function(){return(()=>{function t(n){const o=i[n];if(void 0!==o)return o.exports;const s=i[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}const e=[,(t,e,i)=>{function n(t,e){if(!(this instanceof n))return new n(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,i){if(!i)return e.indexOf(t);for(let n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,n,o){o||(o=f(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var s,a=e;a<i;a++)s=t.children[a],r(o,t.leaf?n(s):s);return o}function r(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function l(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function m(t){return t.maxX-t.minX+(t.maxY-t.minY)}function _(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function u(t,e){const i=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),o=Math.min(t.maxX,e.maxX),s=Math.min(t.maxY,e.maxY);return Math.max(0,o-i)*Math.max(0,s-n)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function x(t,e,i,n,o){const s=[e,i];let a;for(;s.length;)i=s.pop(),e=s.pop(),i-e<=n||(a=e+Math.ceil((i-e)/n/2)*n,g(t,a,e,i,o),s.push(e,a,a,i))}t.exports=n,t.exports.default=n;const g=i(2);n.prototype={all(){return this._all(this.data,[])},search(t){let e=this.data;const i=[],n=this.toBBox;if(!d(t,e))return i;const o=[];let s,a,r,h;for(;e;){for(s=0,a=e.children.length;s<a;s++)r=e.children[s],h=e.leaf?n(r):r,d(t,h)&&(e.leaf?i.push(r):p(t,h)?this._all(r,i):o.push(r));e=o.pop()}return i},collides(t){let e=this.data;const i=this.toBBox;if(!d(t,e))return!1;const n=[];let o,s,a,r;for(;e;){for(o=0,s=e.children.length;o<s;o++)if(a=e.children[o],r=e.leaf?i(a):a,d(t,r)){if(e.leaf||p(t,r))return!0;n.push(a)}e=n.pop()}return!1},load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert(t){return t&&this._insert(t,this.data.height-1),this},clear(){return this.data=f([]),this},remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),s=[],a=[];let r,h,c,l;for(;i||s.length;){if(i||(i=s.pop(),h=s[s.length-1],r=a.pop(),l=!0),i.leaf&&(c=o(t,i.children,e),-1!==c))return i.children.splice(c,1),s.push(i),this._condense(s),this;l||i.leaf||!p(i,n)?h?(r++,i=h.children[r],l=!1):i=null:(s.push(i),a.push(r),r=0,h=i,i=i.children[0])}return this},toBBox:t=>t,compareMinX:h,compareMinY:c,toJSON(){return this.data},fromJSON(t){return this.data=t,this},_all(t,e){const i=[];for(;t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build(t,e,i,n){const o=i-e+1;let a,r=this._maxEntries;if(o<=r)return a=f(t.slice(e,i+1)),s(a,this.toBBox),a;n||(n=Math.ceil(Math.log(o)/Math.log(r)),r=Math.ceil(o/r**(n-1))),a=f([]),a.leaf=!1,a.height=n;const h=Math.ceil(o/r),c=h*Math.ceil(Math.sqrt(r));let l,m,_,u;for(x(t,e,i,c,this.compareMinX),l=e;l<=i;l+=c)for(_=Math.min(l+c-1,i),x(t,l,_,h,this.compareMinY),m=l;m<=_;m+=h)u=Math.min(m+h-1,_),a.children.push(this._build(t,m,u,n-1));return s(a,this.toBBox),a},_chooseSubtree(t,e,i,n){let o,s,a,r,h,c,m,u;for(;n.push(e),!e.leaf&&n.length-1!==i;){for(c=m=1/0,r=0,h=e.children.length;r<h;r++)s=e.children[r],o=l(s),a=_(t,s)-o,a<m?(m=a,c=o<c?o:c,u=s):a===m&&o<c&&(c=o,u=s);e=u||e.children[0]}return e},_insert(t,e,i){const n=this.toBBox,o=i?t:n(t),s=[],a=this._chooseSubtree(o,this.data,e,s);for(a.children.push(t),r(a,o);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(o,s,e)},_split(t,e){const i=t[e],n=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,n);const a=this._chooseSplitIndex(i,o,n),r=f(i.children.splice(a,i.children.length-a));r.height=i.height,r.leaf=i.leaf,s(i,this.toBBox),s(r,this.toBBox),e?t[e-1].children.push(r):this._splitRoot(i,r)},_splitRoot(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex(t,e,i){let n,o,s,r,h,c,m,_;for(m=c=1/0,r=e;r<=i-e;r++)o=a(t,0,r,this.toBBox),s=a(t,r,i,this.toBBox),_=u(o,s),n=l(o)+l(s),_<m?(m=_,h=r,c=n<c?n:c):_===m&&n<c&&(c=n,h=r);return h},_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:h,o=t.leaf?this.compareMinY:c,s=this._allDistMargin(t,e,i,n),a=this._allDistMargin(t,e,i,o);s<a&&t.children.sort(n)},_allDistMargin(t,e,i,n){t.children.sort(n);const o=this.toBBox,s=a(t,0,e,o),h=a(t,i-e,i,o);let c,l,_=m(s)+m(h);for(c=e;c<i-e;c++)l=t.children[c],r(s,t.leaf?o(l):l),_+=m(s);for(c=i-e-1;c>=e;c--)l=t.children[c],r(h,t.leaf?o(l):l),_+=m(h);return _},_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)r(e[n],t)},_condense(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():s(t[i],this.toBBox)},_initFormat(t){const e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a",`return {minX: a${t[0]}, minY: a${t[1]}, maxX: a${t[2]}, maxY: a${t[3]}};`)}}},function(t){var e;e=function(){function t(t,i,o,s,a){e(t,i,o||0,s||t.length-1,a||n)}function e(t,n,o,s,a){for(;s>o;){if(s-o>600){const i=s-o+1,r=n-o+1,h=Math.log(i),c=.5*Math.exp(2*h/3),l=.5*Math.sqrt(h*c*(i-c)/i)*(r-i/2<0?-1:1),m=Math.max(o,Math.floor(n-r*c/i+l)),_=Math.min(s,Math.floor(n+(i-r)*c/i+l));e(t,n,m,_,a)}const r=t[n];let h=o,c=s;for(i(t,o,n),a(t[s],r)>0&&i(t,o,s);h<c;){for(i(t,h,c),h++,c--;a(t[h],r)<0;)h++;for(;a(t[c],r)>0;)c--}0===a(t[o],r)?i(t,o,c):(c++,i(t,c,s)),c<=n&&(o=c+1),n<=c&&(s=c-1)}}function i(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function n(t,e){return t<e?-1:t>e?1:0}return t},t.exports=e()}],i={};t.n=(e=>{const i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i}),t.d=((e,i)=>{for(const n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})}),t.o=((t,e)=>Object.hasOwn(t,e)),t.r=(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})});const n={};return(()=>{t.r(n),t.d(n,{CanvasMarkerLayer:()=>h,canvasMarkerLayer:()=>c});const e=t(1),i=t.n(e);let o=null,s=!1,a=!1,r=!1;var h=L.CanvasMarkerLayer=L.Layer.extend({options:{zIndex:null,collisionFlg:!1,moveReset:!1,opacity:1},initialize(t){L.setOptions(this,t),this._onClickListeners=[],this._onHoverListeners=[],this._onMouseDownListeners=[],this._onMouseUpListeners=[],this._markers=new(i()),this._markers.dirty=0,this._markers.total=0,this._containMarkers=new(i()),this._showMarkers=new(i()),this._showMarkerBounds=new(i())},setOptions(t){return L.setOptions(this,t),this.redraw()},redraw(){return this._redraw(!0)},getEvents(){const t={viewreset:this._reset,zoom:this._onZoom,moveend:this._reset,click:this._executeListeners,mousemove:this._mousemove,mousedown:this._executeListeners,mouseup:this._executeListeners};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),this.options.moveReset&&(t.move=this._reset),t},addLayer(t,e=!0){if("markerPane"!=t.options.pane||!t.options.icon)return void console.error("Layer isn't a marker");t._map=this._map;const i=t.getLatLng();L.Util.stamp(t),this._markers.insert({minX:i.lng,minY:i.lat,maxX:i.lng,maxY:i.lat,data:t}),this._markers.dirty++,this._markers.total++;const n=this._map.getBounds().contains(i);return 1==e&&n&&this._redraw(!0),this},addLayers(t,e=!0){return t.forEach(t=>{this.addLayer(t,!1)}),e&&this._redraw(!0),this},removeLayer(t,e=!0){const i=this;t.minX&&(t=t.data);const n=t.getLatLng(),o=i._map.getBounds().contains(n),s={minX:n.lng,minY:n.lat,maxX:n.lng,maxY:n.lat,data:t};return i._markers.remove(s,function(t,e){return t.data._leaflet_id===e.data._leaflet_id}),i._markers.total--,i._markers.dirty++,!0===o&&!0===e&&i._redraw(!0),this},clearLayers(){this._markers=new(i()),this._markers.dirty=0,this._markers.total=0,this._containMarkers=new(i()),this._showMarkers=new(i()),this._showMarkerBounds=new(i()),this._redraw(!0)},onAdd(t){this._map=t,this._container||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._container):t._panes.overlayPane.appendChild(this._container),this._reset()},onRemove(t){this.options.pane?this.getPane().removeChild(this._container):t.getPanes().overlayPane.removeChild(this._container)},_drawMarker(t,e){const i=this;this._imageLookup||(this._imageLookup={}),e||(e=i._map.latLngToContainerPoint(t.getLatLng()));const n=t.options.icon.options;let o,s,a,r;a=e.x-n.iconAnchor[0],o=a+n.iconSize[0],r=e.y-n.iconAnchor[1],s=r+n.iconSize[1];const h={minX:a,minY:r,maxX:o,maxY:s};if(1==this.options.collisionFlg){if(this._showMarkerBounds.collides(h))return;this._showMarkerBounds.insert(h);const e=t.getLatLng();this._showMarkers.insert({minX:a,minY:r,maxX:o,maxY:s,lng:e.lng,lat:e.lat,data:t})}const c=t.options.icon.options.iconUrl;if(t.canvas_img)i._drawImage(t,e);else if(i._imageLookup[c])t.canvas_img=i._imageLookup[c][0],!1===i._imageLookup[c][1]?i._imageLookup[c][2].push([t,e]):i._drawImage(t,e);else{const n=new Image;n.src=c,t.canvas_img=n,i._imageLookup[c]=[n,!1,[[t,e]]],n.onload=function(){i._imageLookup[c][1]=!0,i._imageLookup[c][2].forEach(function(t){i._drawImage(t[0],t[1])})}}},_drawImage(t,e){const i=t.options.icon.options;this._ctx.save(),this._ctx.globalAlpha=this.options.opacity,this._ctx.translate(e.x,e.y),this._ctx.rotate(i.rotate),this._ctx.drawImage(t.canvas_img,-i.iconAnchor[0],-i.iconAnchor[1],i.iconSize[0],i.iconSize[1]),this._ctx.restore()},_reset(){const t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._container,t);const e=this._map.getSize();this._container.width=e.x,this._container.height=e.y,this._update()},_redraw(t){this._showMarkerBounds=new(i()),this._showMarkers=new(i());const e=this;if(t&&this._ctx.clearRect(0,0,this._container.width,this._container.height),!this._map||!this._markers)return;let n=[];e._markers.dirty/e._markers.total>=.1&&(e._markers.all().forEach(function(t){n.push(t)}),e._markers.clear(),e._markers.load(n),e._markers.dirty=0,n=[]);const o=e._map.getBounds(),s={minX:o.getWest(),minY:o.getSouth(),maxX:o.getEast(),maxY:o.getNorth()};return e._markers.search(s).forEach(function(t){const i=e._map.latLngToContainerPoint(t.data.getLatLng()),o=t.data.options.icon.options.iconSize,s=o[0]/2,a=o[1]/2,r={minX:i.x-s,minY:i.y-a,maxX:i.x+s,maxY:i.y+a,data:t.data,pointPos:i};n.push(r)}),n.sort((t,e)=>{const i=t.data.options.zIndex?t.data.options.zIndex:1,n=e.data.options.zIndex?e.data.options.zIndex:1;return(-i+n)*(this.options.collisionFlg?1:-1)}).forEach(t=>{const i=t.pointPos;e._drawMarker(t.data,i)}),this._containMarkers.clear(),this._containMarkers.load(n),1!=this.options.collisionFlg&&(this._showMarkers=this._containMarkers),this},_initCanvas(){this._container=L.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer"),this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex);const t=this._map.getSize();this._container.width=t.x,this._container.height=t.y,this._ctx=this._container.getContext("2d");const e=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._container,`leaflet-zoom-${e?"animated":"hide"}`)},addOnClickListener(t){this._onClickListeners.push(t)},addOnHoverListener(t){this._onHoverListeners.push(t)},addOnMouseDownListener(t){this._onMouseDownListeners.push(t)},addOnMouseUpListener(t){this._onMouseUpListeners.push(t)},_executeListeners(t){if(!this._showMarkers)return;const e=this,i=t.containerPoint.x,n=t.containerPoint.y;e._openToolTip&&(e._openToolTip.closeTooltip(),delete e._openToolTip);const s=this._showMarkers.search({minX:i,minY:n,maxX:i,maxY:n});if(s&&s.length>0){if(s.reverse(),"click"===t.type&&(clearTimeout(o),o=setTimeout(()=>{const i=s[0].data.getPopup();i&&s[0].data.openPopup(),e._onClickListeners.forEach(function(e){e(t,s)})})),"mousedown"===t.type){if(a)return;a=!0,e._onMouseDownListeners.forEach(function(e){e(t,s)}),setTimeout(()=>{a=!1})}if("mouseup"===t.type){if(r)return;r=!0,e._onMouseUpListeners.forEach(function(e){e(t,s)}),setTimeout(()=>{r=!1})}}},_mousemove(t){if(s)return;if(!this._showMarkers)return;const e=this,i=t.containerPoint.x,n=t.containerPoint.y;e._openToolTip&&(e._openToolTip.closeTooltip(),delete e._openToolTip);const o=this._showMarkers.search({minX:i,minY:n,maxX:i,maxY:n});if(o&&o.length>0){if(o.reverse(),e._map._container.style.cursor="pointer","mousemove"===t.type){s=!0;const i=o[0].data.getTooltip();i&&(e._openToolTip=o[0].data,o[0].data.openTooltip()),e._onHoverListeners.forEach(function(e){e(t,o)})}setTimeout(()=>{s=!1})}else e._map._container.style.cursor=""},_onAnimZoom(t){this._updateTransform(t.center,t.zoom)},_onZoom(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform(t,e){const i=this._map.getZoomScale(e,this._zoom),n=L.DomUtil.getPosition(this._container),o=this._map.getSize().multiplyBy(.5),s=this._map.project(this._center,e),a=this._map.project(t,e),r=a.subtract(s),h=o.multiplyBy(-i).add(n).add(o).subtract(r);L.Browser.any3d?L.DomUtil.setTransform(this._container,h,i):L.DomUtil.setPosition(this._container,h)},_update(){const t=0,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new L.Bounds(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._redraw()},setOpacity(t){return this.options.opacity=t,this._redraw(!0)}}),c=L.canvasMarkerLayer=function(t){return new L.CanvasMarkerLayer(t)}})(),n})()});