L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,exclusiveGroups:[],groupCheckboxes:!1,sortLayers:!1,sortFunction:(e,t,a,s)=>a<s?-1:s<a?1:0},initialize(e,t,a){let s,r;for(s in L.Util.setOptions(this,a),this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._groupList=[],this._domGroups=[],e)this._addLayer(e[s],s);for(s in t)for(r in t[s])this._addLayer(t[s][r],r,s,!0)},onAdd(e){return this._initLayout(),this._update(),e.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove(e){e.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer(e,t){return this._addLayer(e,t),this._update(),this},addOverlay(e,t,a){return this._addLayer(e,t,a,!0),this._update(),this},removeLayer(e){const t=L.Util.stamp(e),a=this._getLayer(t);return a&&this._layers.splice(this._layers.indexOf(a),1),this._update(),this},_getLayer(e){for(let t=0;t<this._layers.length;t++)if(this._layers[t]&&L.stamp(this._layers[t].layer)===e)return this._layers[t]},_initLayout(){const e="leaflet-control-layers",t=this._container=L.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(t,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(t),L.DomEvent.on(t,"wheel",L.DomEvent.stopPropagation));const a=this._form=L.DomUtil.create("form",`${e}-list`);if(this.options.collapsed){L.Browser.android||L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);const a=this._layersLink=L.DomUtil.create("a",`${e}-toggle`,t);a.href="#",a.title="Layers",L.Browser.touch?L.DomEvent.on(a,"click",L.DomEvent.stop).on(a,"click",this._expand,this):L.DomEvent.on(a,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",`${e}-base`,a),this._separator=L.DomUtil.create("div",`${e}-separator`,a),this._overlaysList=L.DomUtil.create("div",`${e}-overlays`,a),t.appendChild(a)},_addLayer(e,t,a,s){L.Util.stamp(e);const r={layer:e,name:t,overlay:s};this._layers.push(r),a=a||"";let o=this._indexOf(this._groupList,a);-1===o&&(o=this._groupList.push(a)-1);const i=-1!==this._indexOf(this.options.exclusiveGroups,a);r.group={name:a,id:o,exclusive:i},this.options.sortLayers&&this._layers.sort((e,t)=>this.options.sortFunction(e.layer,t.layer,e.name,t.name)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},_update(){if(!this._container)return;this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="",this._domGroups.length=0;let e=!1;let t,a=!1;for(var s=0;s<this._layers.length;s++)t=this._layers[s],this._addItem(t),a=a||t.overlay,e=e||!t.overlay;this._separator.style.display=a&&e?"":"none"},_onLayerChange(e){const t=this._getLayer(L.Util.stamp(e.layer));let a;t&&(this._handlingClick||this._update(),a=t.overlay?"layeradd"===e.type?"overlayadd":"overlayremove":"layeradd"===e.type?"baselayerchange":null,a&&this._map.fire(a,t))},_createRadioElement(e,t){let a=`<input type="radio" class="leaflet-control-layers-selector" name="${e}"`;t&&(a+=' checked="checked"'),a+="/>";const s=document.createElement("div");return s.innerHTML=a,s.firstChild},_addItem(e){const t=document.createElement("label");let a;const s=this._map.hasLayer(e.layer);let r,o;e.overlay?e.group.exclusive?(o=`leaflet-exclusive-group-layer-${e.group.id}`,a=this._createRadioElement(o,s)):(a=document.createElement("input"),a.type="checkbox",a.className="leaflet-control-layers-selector",a.defaultChecked=s):a=this._createRadioElement("leaflet-base-layers",s),a.layerId=L.Util.stamp(e.layer),a.groupID=e.group.id,L.DomEvent.on(a,"click",this._onInputClick,this);const i=document.createElement("span");if(i.innerHTML=` ${e.name}`,t.appendChild(a),t.appendChild(i),e.overlay){r=this._overlaysList;let t=this._domGroups[e.group.id];if(!t){t=document.createElement("div"),t.className="leaflet-control-layers-group",t.id=`leaflet-control-layers-group-${e.group.id}`;const a=document.createElement("label");if(a.className="leaflet-control-layers-group-label",""!==e.group.name&&!e.group.exclusive&&this.options.groupCheckboxes){const t=document.createElement("input");t.type="checkbox",t.className="leaflet-control-layers-group-selector",t.groupID=e.group.id,t.legend=this,L.DomEvent.on(t,"click",this._onGroupInputClick,t),a.appendChild(t)}const s=document.createElement("span");s.className="leaflet-control-layers-group-name",s.innerHTML=e.group.name,a.appendChild(s),t.appendChild(a),r.appendChild(t),this._domGroups[e.group.id]=t}r=t}else r=this._baseLayersList;return r.appendChild(t),t},_onGroupInputClick(){let e,t,a;const s=this.legend;s._handlingClick=!0;const r=s._form.getElementsByTagName("input"),o=r.length;for(e=0;e<o;e++)t=r[e],t.groupID===this.groupID&&"leaflet-control-layers-selector"===t.className&&(t.checked=this.checked,a=s._getLayer(t.layerId),t.checked&&!s._map.hasLayer(a.layer)?s._map.addLayer(a.layer):!t.checked&&s._map.hasLayer(a.layer)&&s._map.removeLayer(a.layer));s._handlingClick=!1},_onInputClick(){let e,t,a;const s=this._form.getElementsByTagName("input"),r=s.length;for(this._handlingClick=!0,e=0;e<r;e++)t=s[e],"leaflet-control-layers-selector"===t.className&&(a=this._getLayer(t.layerId),t.checked&&!this._map.hasLayer(a.layer)?this._map.addLayer(a.layer):!t.checked&&this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer));this._handlingClick=!1},_expand(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");const e=this._map._size.y-4*this._container.offsetTop;e<this._form.clientHeight&&(L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=`${e}px`)},_collapse(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")},_indexOf(e,t){for(let a=0,s=e.length;a<s;a++)if(e[a]===t)return a;return-1}}),L.control.groupedLayers=function(e,t,a){return new L.Control.GroupedLayers(e,t,a)};